# Docker Workflows - Quick Reference

## Two Setup Options

### Option 1: Local Workflow (Simple, Self-Contained)
- Workflow files live in each repository
- Good for: Single repo or learning
- Setup time: 2 minutes per repo

**Files:**
- `setup-docker-workflows.sh` - Generates everything for you

---

### Option 2: Shared Workflows Repository (Advanced, Maintainable)
- Create one `my-workflows` repo with reusable workflows
- Reference it from all your app repos
- Good for: Multiple repos, consistency, easy updates
- Setup time: 5 minutes for shared repo + 1 minute per app repo

**Files:**
- `shared-workflows-docker-build-push.yml` - Goes in `my-workflows/.github/workflows/`
- `setup-shared-workflows.sh` - Quick setup for each app repo that uses the shared one

---

## Quick Decision Tree

**Use Option 1 (Local) if:**
- You only have 1-2 repos
- You want simplicity
- Each repo has different build requirements

**Use Option 2 (Shared) if:**
- You have 3+ repos
- You want to update workflows in one place
- Your repos have similar Docker build setups

---

## Option 1: Local Setup Process

```bash
# 1. In each repo
cd ~/my-app-repo
chmod +x setup-docker-workflows.sh
./setup-docker-workflows.sh

# 2. Answer questions
# 3. Commit and push
git add .github/workflows/
git commit -m "Add Docker workflows"
git push
```

---

## Option 2: Shared Setup Process

### Part A: Create Shared Repo (Once)

```bash
# 1. Create repo on GitHub called "my-workflows"

# 2. Clone and setup locally
git clone https://github.com/your-username/my-workflows.git
cd my-workflows
mkdir -p .github/workflows

# 3. Copy docker-build-push.yml to .github/workflows/

# 4. Commit and push
git add .github/workflows/
git commit -m "Add Docker build workflow"
git push origin main
```

### Part B: Use in Each App Repo (Repeat for Each Repo)

```bash
# 1. In each app repo
cd ~/my-app-repo
chmod +x setup-shared-workflows.sh
./setup-shared-workflows.sh

# 2. Enter:
#    - Shared workflows repo: your-username/my-workflows
#    - Version: main (or v1.0.0 for stable)
#    - Docker image name: your-username/my-app
#    - Other settings...

# 3. Commit and push
git add .github/workflows/ci.yml
git commit -m "Add Docker CI/CD using shared workflows"
git push
```

---

## Files Summary

| File | Purpose | Use Case |
|------|---------|----------|
| `setup-docker-workflows.sh` | Generate all workflow files locally | Option 1: Local setup |
| `shared-workflows-docker-build-push.yml` | Reusable workflow | Option 2: Put in `my-workflows` repo |
| `setup-shared-workflows.sh` | Quick setup for app repos | Option 2: Run in each app repo |
| `docker-build-push.yml` | Local reusable workflow | Option 1: Generated by script |
| `ci.yml` | Main workflow | Both options: Generated by script |
| `SETUP_GUIDE.md` | Detailed guide for Option 1 | Option 1 reference |
| `SHARED_WORKFLOWS_SETUP.md` | Detailed guide for Option 2 | Option 2 reference |

---

## What Happens After Setup

### You Push Code
```bash
git push origin main
```

### GitHub Runs Your Workflow
1. Triggers `ci.yml`
2. `ci.yml` calls the build workflow (local or shared)
3. Builds Docker image
4. Pushes to Docker Hub
5. You see results in Actions tab

### To Check Status
- Go to your repo on GitHub
- Click "Actions" tab
- See your workflow running/completed

---

## Adding Secrets (Both Options)

Same for both setups:

```bash
# Using GitHub CLI (easier)
gh secret set DOCKERHUB_USERNAME --body "your-username"
gh secret set DOCKERHUB_TOKEN --body "your-token"
```

Or manually in GitHub Settings → Secrets and variables → Actions

---

## Recommendation

**Start with Option 1 (Local)** to learn how it works, then migrate to **Option 2 (Shared)** if you have multiple repos.

Converting from Option 1 → Option 2 is just moving the workflow file and changing the reference.

---

## Common Questions

**Q: Do I need BOTH the local AND shared scripts?**  
A: No. Pick one approach (Option 1 OR Option 2), not both.

**Q: Can I use the shared workflow repo if it's private?**  
A: No, it must be public for GitHub Actions to access it.

**Q: What if I want to update the workflow later?**  
A: 
- Option 1: Edit each repo's workflow
- Option 2: Edit once in shared repo (all repos using `@main` get it automatically)

**Q: Can I switch between local and shared?**  
A: Yes! It's just a different reference path in `ci.yml`.

---

**Questions?** Check the detailed guides:
- `SETUP_GUIDE.md` for Option 1
- `SHARED_WORKFLOWS_SETUP.md` for Option 2
